"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],o=!0,r=!1,a=void 0;try{for(var s,i=e[Symbol.iterator]();!(o=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);o=!0);}catch(e){r=!0,a=e}finally{try{o||null==i.return||i.return()}finally{if(r)throw a}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}!function(){var p={version:7,storage:window.localStorage,app:{clickSubmit:!0,showHint:!0,randomOrder:!0,allRoots:!1,answers:5},options:{},celebrations:["filler","bouncer","fireworks","tree","aquarium","bear","stars"],celebrationChance:15,used:[],roots:[],commonIndexes:[],celebration:null,currentIndex:-1,question:{word:-1,duration:-1,answers:[],dateTime:null},answerQueue:[],answerQueueSize:20,exclamations:["Amazing","Awesome","Brilliant","Capital","Cracking","Excellent","Exceptional","Exquisite","Fabulous","Fantastic","Great","Marvelous","Nice","Splendid","Stellar","Superb","Superior","Supreme","Terrific","Tip-Top"],entityMap:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},escapeHtml:function(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return p.entityMap[e]})},init:function(){$(".tap-target").tapTarget(),$("#hintCollapsible").collapsible(),$(".sidenav").sidenav(),$(".dropdown-trigger").dropdown({constrainWidth:!1,closeOnClick:!1,coverTrigger:!1}),$("select").formSelect(),p.loadRoots(),p.db.setup()},setup:function(){$("#reports").hide(),p.loadSettings(),p.bindSettings($("#slide-out")),p.nextRoot(!1),$("#nextRoot").click(p.nextRoot),$("#checkAnswer").click(p.checkAnswer)},loadSettings:function(){var e=p.storage.getItem("settings");null===e?p.storage.setItem("settings",JSON.stringify(p.app)):p.app=JSON.parse(e)},buildCommonIndex:function(e){var o,t=0<arguments.length&&void 0!==e?e:[];0<p.roots.length&&(console.log("Build common indexes"),o=p.roots.map(function(e){return e[0]}),$.each(t,function(e,t){var n=o.indexOf(t);-1!==n?p.commonIndexes.push(n):console.log("Root not found: "+t)}))},bindSettings:function(o){var e=$("input",o);$.each(p.app,function(e,t){var n=$('[name="'+e+'"]',o);switch(n.prop("type")){case"checkbox":n.prop("checked",t);break;default:n.val(t)}}),e.change(p.handleSettingChanged)},handleSettingChanged:function(e){var t=$(e.currentTarget),n=t.prop("name");switch("checkbox"===t.prop("type")?p.app[n]=t.prop("checked"):p.app[n]=t.val(),p.storage.setItem("settings",JSON.stringify(p.app)),n){case"clickSubmit":p.setClickSubmit(p.app[n]);break;case"randomOrder":p.app.randomOrder||(p.currentIndex=0,p.nextRoot());break;case"showHint":p.toggleHint();break;case"answers":p.renderAnswers(p.currentIndex)}},setClickSubmit:function(e){var t=!(0<arguments.length&&void 0!==e)||e,n=$("#answerContainer");t?($("#checkAnswer").hide(),$("input[type='radio']",n).change(p.checkAnswer)):($("#checkAnswer").show(),$("input[type='radio']",n).off("change",p.checkAnswer))},toggleHint:function(){var e=M.Collapsible.getInstance($("#hintCollapsible")[0]);p.app.showHint?e.open():e.close()},nextRoot:function(e){var t=!(0<arguments.length&&void 0!==e)||e,n=p.getNextIndex(),o=p.roots[n],r=0;p.toggleHint(),null!==p.celebration&&(p.celebration.hide(),p.celebration=null),t&&($(".card-content").addClass("scale-out"),r=300),$("#nextRoot").addClass("disabled"),p.currentIndex=n,window.setTimeout(function(){$("#latinRoot").text(o[p.options.WORD]),$("#rootOrigin").text(o[p.options.ORIGIN]),p.renderAnswers(n),p.renderHint(o[p.options.HINT]),$(".card-content").removeClass("scale-out"),p.question={word:o[p.options.WORD],duration:Date.now(),answers:[]}},r)},renderHint:function(e){$("#rootHint").html('<span class="tooltipped">'+e.split(/\s*,\s*/).join('</span>, <span class="tooltipped">')+"</span>")},checkAnswer:function(e){var t,n,o,r,a=$("#answerContainer"),s=$("input[name='answerGroup']:checked");p.question.answers.push(s.val()),p.question.dateTime=(new Date).getTime(),s.val()===a.data("answer")?($("#checkAnswer").prop("disabled",!0),(t=$("#nextRoot")).removeClass("disabled"),$("#answerContainer input").prop("disabled",!0),0===Math.floor(Math.random()*p.celebrationChance)?(n=$("#lets-celebrate"),t.addClass("disabled"),n.addClass("show"),window.setTimeout(function(){n.removeClass("show"),t.removeClass("disabled"),p.celebrate()},1600)):1===p.question.answers.length?((o=$(e.currentTarget).offset()).left+=30,window.explode(o.left,o.top),r=p.exclamations[Math.floor(Math.random()*p.exclamations.length)],$("#exclamation").text(r).css({left:o.left,top:o.top}).addClass("show"),window.setTimeout(function(){$("#exclamation").removeClass("show")},1e3)):M.toast({html:"Correct",classes:"correct",displayLength:1e3}),p.finishAnswer()):M.toast({html:"Try again",classes:"incorrect",displayLength:1e3})},finishAnswer:function(){p.question.duration=Date.now()-p.question.duration,p.db.saveAnswer(p.question)},getNextIndex:function(){if(0===p.roots.length)throw"Roots not loaded";var e,t=p.app.randomOrder?p.getRandomIndex():(++p.currentIndex,e=p.app.allRoots?p.roots.length:p.commonIndexes.length,p.currentIndex>=e&&(p.currentIndex=0),p.currentIndex);return-1!==p.answerQueue.indexOf(t)?p.getNextIndex():(p.answerQueue.push(t),p.answerQueue.length>p.answerQueueSize&&p.answerQueue.shift(),t)},renderAnswers:function(e){for(var t="",n=[e],o=$("#answerContainer"),r=p.roots[e],a=Math.floor(Math.random()*p.app.answers),s=0;s<p.app.answers;){var i,c=p.getRandomIndex();-1===n.indexOf(c)&&(t+='<p><label><input name="answerGroup" type="radio" value="'+(i=s===a?r:p.roots[c])[p.options.ANSWER]+'" /><span>'+i[p.options.ANSWER]+"</span></label></p>",s++,n.push(c))}o.html(t),o.data("answer",r[p.options.ANSWER]),p.app.clickSubmit&&p.setClickSubmit(!0)},getRandomIndex:function(){if(p.app.allRoots)return Math.floor(Math.random()*p.roots.length);var e=Math.floor(Math.random()*p.commonIndexes.length);return p.commonIndexes[e]},loadJson:function(){$.getJSON({url:"/app/roots.json?_="+(new Date).getTime(),success:function(e){p.options=e.options,p.roots=e.data,p.buildCommonIndex(e.common),p.storage.setItem("latinRoots",JSON.stringify({version:p.version,options:e.options,roots:e.data,common:e.common,commonIndexes:p.commonIndexes})),p.setup()}})},loadRoots:function(){var e=p.storage.getItem("latinRoots");if(null===e)p.loadJson(),$(".tap-target").tapTarget("open");else{var t=JSON.parse(e);if(t.version!==p.version)return window.localStorage.removeItem("latinRoots"),void p.loadRoots();p.options=t.options,p.roots=t.roots,p.commonIndexes=t.commonIndexes,p.setup()}},toggleOption:function(e){var t,n=$("input[type=checkbox]",e.currentTarget);n.length&&(n.prop("checked",!n.prop("checked")),(t=$.Event("click")).currentTarget=n,p.handleSettingChanged(t))},showReports:function(){$(".sidenav").sidenav("close"),$("#questions").fadeOut(200,function(){$("#reports").fadeIn(200)}),p.db.getData()},hideReports:function(){$("#reports").hide(200,function(){$("#questions").fadeIn(200)})},celebrate:function(){$("body").addClass("celbrate"),p.celebration=p.celebrations[Math.floor(Math.random()*p.celebrations.length)],p.celebration.show(),$("#celebrations").click(p.uncelebrate),$(window).resize(p.celebration.resize)},uncelebrate:function(){$("body").removeClass("celbrate"),p.celebration.hide(),p.nextRoot(p.uncelebrate),$(window).off("resize",window.canvas.resize),$("#celebrations").off("click",p.uncelebrate)}};p.db={db:null,name:"latin",version:3,numStats:10,setup:function(){var e;window.indexedDB?((e=window.indexedDB.open(p.db.name,p.db.version)).onsuccess=function(e){p.db.db=e.target.result,console.debug("IndexedDb connected: "+p.db.db)},e.onupgradeneeded=p.db.upgradeNeeded):console.log("This browser doesn't support IndexedDB")},upgradeNeeded:function(e){p.db.db=e.target.result,console.debug("Upgrading database from "+e.oldVersion),p.db.db.objectStoreNames.contains("answers")||p.db.db.createObjectStore("answers",{keyPath:"id",autoIncrement:!0}).createIndex("answerIndex","answers.dateTime",{unique:!0})},saveAnswer:function(e){console.debug("Saving...");var t=p.db.db.transaction(["answers"],"readwrite");t.oncomplete=function(){console.debug("Transaction complete")},t.onerror=function(){console.error("Unable to save data")};var n=t.objectStore("answers").add(e);console.debug("save: "+e),n.onsuccess=function(){console.debug("Data saved")}},saveAnswers:function(e){e.forEach(function(e){p.db.saveAnswer(e)})},msToTime:function(e){var t=Math.floor(e/1e3%60),n=Math.floor(e/6e4%60),o=Math.floor(e/36e5%24);return(o=o<10?"0"+o:o)+":"+(n=n<10?"0"+n:n)+":"+(t=t<10?"0"+t:t)},msToDate:function(e){var t=new Date(e);return"".concat(t.getFullYear(),"-").concat(t.getMonth(),"-").concat(t.getDate())},addDayStats:function(e,t){var n=p.db.msToDate(t.dateTime);void 0===e[n]&&(e[n]={duration:0,questions:0,answers:0,times:[]});var o=e[n];o.duration+=t.duration,o.times.push(t.dateTime),o.questions++,o.answers+=t.answers.length},showLatinStats:function(e){$("#totals-questions").text(e.questions),$("#totals-answers").text(e.guesses),$("#totals-time").text(p.db.msToTime(e.duration))},getData:function(){$("#out").text("");var r={questions:0,guesses:0,duration:0},a={},s=new Map,e=p.db.db.transaction(["answers"]).objectStore("answers").openCursor();e.onerror=function(e){console.error("Query error: "+e)},e.onsuccess=function(e){var t,n,o=e.target.result;o?(r.questions++,r.guesses+=o.value.answers.length,r.duration+=60<o.value.duration?60:o.value.duration,t=o.value.word,void 0===(n=s.get(t))&&(n={occurances:0,guesses:0},s.set(t,n)),n.occurances++,n.guesses+=o.value.answers.length,p.db.addDayStats(a,o.value),o.continue()):(p.db.showLatinStats(r),p.db.showWordStats(s),p.db.showChart(a))}},showWordStats:function(e){var t=new Map(_toConsumableArray(e.entries()).sort(function(e,t){return t[1].guesses-e[1].guesses})),n=new Map(_toConsumableArray(e.entries()).sort(function(e,t){return e[1].guesses-t[1].guesses})),o=new Map(_toConsumableArray(e.entries()).sort(function(e,t){return e[1].occurances-t[1].occurances})),r=new Map(_toConsumableArray(e.entries()).sort(function(e,t){return t[1].occurances-e[1].occurances}));p.db.renderWordStats($("#most-correct"),"guesses",n),p.db.renderWordStats($("#least-correct"),"guesses",t),p.db.renderWordStats($("#most-seen"),"occurances",r),p.db.renderWordStats($("#least-seen"),"occurances",o)},renderWordStats:function(e,t,n){var o=0;e.html("");var r=!0,a=!1,s=void 0;try{for(var i,c=n[Symbol.iterator]();!(r=(i=c.next()).done);r=!0){var l=_slicedToArray(i.value,2),d=l[0],u=l[1];if(e.append('<li class="collection-item"><span class="badge">'.concat(u[t],"</span>").concat(d,"</li>")),++o>=p.db.numStats)break}}catch(e){a=!0,s=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw s}}},chartColors:{green:"#388E3C",green2:"#4CAF50",blue:"#2962ff",blue2:"#448AFF",red:"#f44336",orange:"rgb(255, 159, 64)",yellow:"rgb(255, 205, 86)",purple:"rgb(153, 102, 255)",grey:"rgb(201, 203, 207)"},renderQuestionsAndGuessesChart:function(e,t,n,o){var r={labels:e,datasets:[{type:"line",label:"Avg. Answsers per Question",backgroundColor:p.db.chartColors.red,fill:!1,stack:"Stack 1",pointHoverRadius:10,data:o},{type:"bar",label:"Questions",borderWidth:1,borderColor:p.db.chartColors.green,backgroundColor:p.db.chartColors.green2,stack:"Stack 0",data:n},{type:"bar",label:"Guesses",borderWidth:1,borderColor:p.db.chartColors.blue,backgroundColor:p.db.chartColors.blue2,stack:"Stack 0",data:t}]},a=$("<canvas>");$("#charts").append(a),new Chart(a[0].getContext("2d"),{type:"bar",data:r,options:{responsive:!0,legend:{position:"top"},hover:{mode:"index"},title:{display:!0,text:"Questions & Answers"},scales:{xAxes:[{stacked:!0}],yAxes:[{stacked:!0}]}}})},renderSecondsPerQuestionChart:function(e,t,n){var o={labels:e,datasets:[{type:"bar",label:"Total Time (Minutes)",borderWidth:1,borderColor:p.db.chartColors.green,backgroundColor:p.db.chartColors.green2,data:t},{type:"line",label:"Avg. Time per Word",borderWidth:1,borderColor:p.db.chartColors.blue,backgroundColor:p.db.chartColors.blue2,data:n}]},r=$("<canvas>");$("#charts").append(r),new Chart(r[0].getContext("2d"),{type:"bar",data:o,options:{responsive:!0,legend:{position:"top"},title:{display:!0,text:"Time"}}})},showChart:function(e){var t=Object.keys(e),o=[],r=[],a=[],s=[],i=[];$.each(e,function(e,t){var n=60<(n=t.duration/1e3)?60:n;o.push(t.questions),r.push(t.answers),s.push(n/t.questions),a.push(Math.ceil(n/60)),i.push(t.answers/t.questions)}),$("#charts").html(""),p.db.renderQuestionsAndGuessesChart(t,r,o,i),p.db.renderSecondsPerQuestionChart(t,a,s)}},$(window.document).ready(p.init)}();